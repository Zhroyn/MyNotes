
# 二项队列

尽管左倾树和斜堆实现了 $O(\log N)$ 复杂度的插入操作，但是无法像普通堆一样，实现 $O(N)$ 复杂度的建堆操作，因此需要引入二项队列。二项队列是一组堆有序的二项树的集合，这里以最小优先队列为例。

定义只有一个节点的二项树的高度为 0，记为 $B_0$；高度为 $k$ 的二项树由两个高度为 $k-1$ 的二项树合并而成，以其中的较小的根节点为新的根节点，记为 $B_k$。这样以后，可得二项树有如下性质：

- $B_k$ 的根节点有 $k$ 个儿子，分别为 $B_0, B_1, \cdots, B_{k-1}$
- $B_k$ 有 $2^k$ 个节点
- 深度 $d$ 的节点数为 $\begin{pmatrix} k \\ d \end{pmatrix}$

所有数字都可以表示为唯一的二进制数，因此给定固定长度的二项队列，其中有无 $B_k$ 是确定的。

因为二项树的儿子节点数是不定的，且没有随机访问儿子节点的需求，因此此处使用左儿子右兄弟的表示法。

## 合并

在合并两个二项树时，可以直接将根节点较大的二项树置为另一个二项树的左儿子，这样就能以极小的代价保证 $B_k$ 根节点的所有儿子以 $B_{k-1}, \cdots, B_1, B_0$ 的顺序排序，有利于后续删除操作。

在合并两个二项队列时，可以将这个过程看作两个二进制数相加的过程，进位的过程就是合并二项树的过程。若进位后有三个 $B_k$，此时可以为了方便直接合并原有 $B_k$，也可以选择合并其中根节点最大的二项树和另一个二项树，以使那个最大的根节点不再是根节点，有利于加快查询最小值的操作。

## 插入与删除

插入操作即为将一个元素看作一个二项队列，然后与原有二项队列合并。

删除操作即为将最小元素所在的二项树的根节点移除，将该根节点的所有儿子视为新的二项队列，将其与其余二项树合并。

## 分析

易得查询最小值的复杂度为 $O(\log N)$，合并二项树的复杂度为 $O(1)$。因此，合并二项队列的复杂度为 $O(\log N) \times O(1) = O(\log N)$，插入和删除操作的最坏时间复杂度是 $O(\log N)$。

现考虑从零开始逐个插入元素的情况：

聚合法：因为只有进位时才会进行合并二项树操作，而从最低一位开始，在对应位置发生进位需要的插入次数依次为 2、4、8、...，因此最终合并二项树的次数为 $\frac{N}{2} + \frac{N}{4} + \cdots = N$，总的建堆时间复杂度为 $O(N)$。

势能法：定义势能函数为二项树的数量，实际代价为合并次数加一，则当 $c_i = c$ 时，$\Phi_i - \Phi_{i-1} = 1 - (c - 1) = 2 - c$，因此均摊代价 $\hat{c}_i = 2$，总的建堆时间复杂度为 $O(N)$。

